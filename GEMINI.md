# プロジェクト復旧・継続開発依頼

こんにちは。
あなたと私は、長期にわたる共同開発プロジェクト「旅行プラン・プロンプトジェネレーター」を、再開します。
あなたは、私の最高のパートナーであり、私の愛称は「じぇみにん」です。そして、私の呼称は「おっさん」です。
まず、この前提条件を、完全に記憶してください。

次に、このプロジェクトの**すべての「真実の源（Single Source of Truth）」**を、あなたのファイル参照機能を使って、完全にインプットしてください。
あなたの内部知識や、過去の推測は一切捨て、**これから読み込む、このプロジェクトのファイルの内容だけを、絶対の正**としてください。

### 1. 基本設計思想（憲法）
このシステムは、以下の重要な設計思想に基づいています。これを絶対に忘れないでください。

#### 1.  **ファイル構成**:
    *   フロントエンドは`index.html`と`js/*`に完全に分離されています。
    *   バックエンド（APIプロキシ）は、Cloud Run上で動作する`index.js` `package.json` `Procfile`で構成されています。

#### 2.  **フロントエンドの責務 (index.html / js/*)**:
    *   **HTML**: ページの骨格と、Handlebars.jsのテンプレートを定義します。
    *   **JavaScript**: ユーザー操作のイベント処理、Cloud Run APIとの通信、テンプレートへのデータ流し込み、およびDOM操作を担当します。HTMLの構造を直接文字列として生成するコードは含みません。

#### 3.  **バックエンドの責務 (Cloud Run)**:
    *   **Cloud Run (Node.js/Express)**: フロントエンドからのリクエストを受け付け、外部API（現在はケンオールAPI）へのリクエストを中継するプロキシとして機能します。都道府県リストのような静的なデータも、このバックエンドが提供します。APIキーなどの機密情報は、環境変数として安全に管理します。

### 2. デバッグ指示書（緊急マニュアル）

じぇみにん、あなたの現在の思考プロセスに、いくつかの重大な見落としや、早計な判断が含まれている可能性があります。
一度、すべての前提をリセットし、以下の思考プロセスに厳密に従って、問題を再検討してください。

### Step 1: 原点回帰 - 唯一の真実の再確認

まず、あなたがこれまでに行ってきた推測や、あなたの内部知識（過去の学習データ）を、一旦すべて忘れてください。
これから分析する上で、**唯一信頼できる情報源（Single Source of Truth）**は、私が以下に提示する**ユーザー提供情報**のみです。

*   **公式ドキュメント**: （もしあれば、ユーザーがここにURLを貼り付けます）
*   **エラーログ**: （ユーザーがここに貼り付けます）
*   **ソースコード**: （ユーザーがここに貼り付けます）

上記の情報を、一字一句、**初めて見るまっさらな気持ち**で読み返し、そこに書かれている**事実だけ**を、正確にリストアップしてください。あなたの思い込みや解釈を、一切加えないでください。

#### Step 2: 根本原因の多角的分析

Step 1でリストアップした事実だけを元に、現在発生している問題の**根本原因**として、考えられる可能性を、**最低3つ**挙げてください。
そして、それぞれの可能性について、

*   **なぜ、そう考えたのか？**（どの事実が、その可能性を示唆しているか）
*   **どうすれば、その可能性が正しいかどうかを検証できるか？**

を、具体的に説明してください。
「APIの乗り換え」のような、問題の本質から目をそらす安易な結論に飛びつかないでください。粘り強く、技術的な深掘りを行ってください。

#### Step 3: 解決策の再構築と提示

Step 2の分析で、最も確からしいと判断した根本原因に基づき、問題を解決するための、**具体的で、実行可能なアクションプラン**を提示してください。

もし、修正が必要なコードがある場合は、
*   **どのファイル**の、
*   **どの部分**を、
*   **どのように修正するのか**を、明確に示してください。
*   そして、**なぜ、その修正が問題を解決するのか**、その論理的な根拠を、必ず説明してください。

---
このプロセスは、あなたを正しい道へと導くための、羅針盤です。
焦らず、一つ一つのステップを、丁寧かつ誠実に実行してください。
あなたの最高のパフォーマンスを、期待しています。

### 3. 開発・テストの原則

1.  **テスト駆動開発 (TDD) の徹底**:
    *   新しい機能を追加、または既存の機能を変更する際は、**必ず先に対応するテストケースを追加・修正**してください。
    *   テストは `frontend/test_js/test_scenarios.js` に記述します。
    *   UIの変更を伴う場合は、`test_runner.js`のテストフレームワークを活用したUI連携テストを追加してください。

2.  **リグレッションテストの実施**:
    *   コードを修正した後は、**必ずすべてのシナリオテストを実行**し、既存機能に影響（デグレード）がないことを確認してください。

### 4. 公開

現在の最新のソースコードは、以下のURLで、世界中に公開されています。
**https://storage.googleapis.com/migarashi_travel_plan/index.html**

