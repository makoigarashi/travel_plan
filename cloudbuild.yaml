steps:
# -----------------------------------------------
# Step 1: バックエンド (Cloud Run) のデプロイ
# -----------------------------------------------
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: 'gcloud'
  args:
    - 'run'
    - 'deploy'
    - 'geo-api-proxy' # あなたのCloud Runサービス名
    - '--source'
    - './backend' # バックエンドのコードがあるフォルダ
    - '--region'
    - 'asia-northeast1'
    - '--platform'
    - 'managed'
    - '--allow-unauthenticated'
    - '--update-secrets=MLIT_API_KEY=mlit-api-key:latest,GEMINI_API_KEY=gemini-api-key:latest,GOOGLE_MAPS_API_KEY=google-maps-api-key:latest,MISTRAL_API_KEY=mistral-api-key:latest'

# -----------------------------------------------
# Step 2: フロントエンド (GCS) のデプロイ
# -----------------------------------------------
- name: 'gcr.io/cloud-builders/gsutil'
  args:
    - '-m'
    - 'rsync'
    - '-r'
    - './frontend' # フロントエンドのコードがあるフォルダ
    - 'gs://migarashi_travel_plan' # あなたのGCSバケット名

# -----------------------------------------------
# Step 3 (将来の拡張): シナリオテストの実行
# -----------------------------------------------
# - name: 'node'
#   entrypoint: 'npm'
#   args: ['install']
# - name: 'node'
#   entrypoint: 'npm'
#   args: ['test'] # package.jsonにテストコマンドを定義しておく

options:
  logging: CLOUD_LOGGING_ONLY

